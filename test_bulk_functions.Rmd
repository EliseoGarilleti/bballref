---
title: "Testing Bulk Functions - bballref Package"
output: html_document
date: "`r Sys.Date()`"
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE, warning = FALSE, message = FALSE)
library(devtools)
load_all()
library(dplyr)
library(knitr)
```

# Testing New Bulk Functions

This document tests the new bulk functions added to the bballref package.

---

## 1. Team Stats Bulk - Multiple Teams, Same Year

Get per game stats for Lakers and Heat in 2020 (NBA Finals matchup):

```{r team_bulk_1}
finals_2020 <- team_stats_bulk(
  stat_function = team_per_game,
  teams = c("LAL", "MIA"),
  years = 2020,
  season_type = "regular",
  progress = FALSE
)

# Show first rows
head(finals_2020, 10) %>%
  select(Player, Age, Tm, G, PTS, AST, TRB, team) %>%
  kable()
```

**Summary:**

- Total rows: `r nrow(finals_2020)`
- Teams: `r paste(unique(finals_2020$team), collapse = ", ")`

---

## 2. Team Stats Bulk - One Team, Multiple Years

Get Lakers per game stats from 2022 to 2024:

```{r team_bulk_2}
lakers_history <- team_stats_bulk(
  stat_function = team_per_game,
  teams = "LAL",
  years = 2022:2024,
  progress = FALSE
)

# Show first rows
head(lakers_history, 12) %>%
  select(Player, Age, Tm, G, PTS, AST, TRB, season) %>%
  kable()
```

**Summary:**

- Total rows: `r nrow(lakers_history)`
- Seasons: `r paste(sort(unique(lakers_history$season)), collapse = ", ")`

---

## 3. Player Stats Bulk - Compare Multiple Players

Compare career per game stats for LeBron James and Stephen Curry:

```{r player_bulk_1}
stars <- player_stats_bulk(
  stat_function = player_per_game,
  players = c("LeBron James", "Stephen Curry"),
  season_type = "regular",
  progress = FALSE
)

# Show first 5 seasons for each player
stars %>%
  group_by(player_name) %>%
  slice(1:5) %>%
  select(Season, Age, Tm, G, PTS, AST, TRB, player_name) %>%
  kable()
```

**Summary:**

- Total rows: `r nrow(stars)`
- Players: `r paste(unique(stars$player_name), collapse = ", ")`
- LeBron seasons: `r sum(stars$player_name == "LeBron James", na.rm = TRUE)`
- Curry seasons: `r sum(stars$player_name == "Stephen Curry", na.rm = TRUE)`

---

## 4. Team Aggregate Stats - Filtered by Years

Get Lakers aggregate totals for years 2015-2024:

```{r aggregate_filter_1}
lakers_recent <- team_stats_totals("LAL", years = 2015:2024)

# Show all rows
lakers_recent %>%
  select(Season, Lg, Tm, W, L, Age, team) %>%
  kable()
```

**Summary:**

- Total rows: `r nrow(lakers_recent)`
- Seasons included: `r paste(lakers_recent$Season, collapse = ", ")`

---

## 5. Team Aggregate Stats Per Game - Specific Years

Get Celtics aggregate per game stats for selected years:

```{r aggregate_filter_2}
celtics_selected <- team_stats_per_game("BOS", years = c(2008, 2010, 2020, 2024))

# Show all rows
celtics_selected %>%
  select(Season, Lg, Tm, W, L, Age, team) %>%
  kable()
```

**Summary:**

- Total rows: `r nrow(celtics_selected)`
- Seasons: `r paste(celtics_selected$Season, collapse = ", ")`

---

## 6. Team Aggregate Stats - All Years (Default)

Get Warriors aggregate totals (no year filter) - showing first 10 rows:

```{r aggregate_all}
warriors_all <- team_stats_totals("GSW")

# Show first 10 rows
head(warriors_all, 10) %>%
  select(Season, Lg, Tm, W, L, Age, team) %>%
  kable()
```

**Summary:**

- Total rows: `r nrow(warriors_all)`
- Earliest season: `r tail(warriors_all$Season, 1)`
- Latest season: `r head(warriors_all$Season, 1)`

---

## Summary of New Functions

### 1. `team_stats_bulk(stat_function, teams, years, ...)`

Fetch data for multiple teams and/or multiple years:

```{r example1, eval=FALSE}
# Multiple teams, same year
team_stats_bulk(team_per_game, c("LAL", "BOS"), 2024)

# One team, multiple years
team_stats_bulk(team_totals, "LAL", 2020:2024)

# Multiple teams and years
team_stats_bulk(team_advanced, c("LAL", "BOS"), 2022:2024)
```

Features:
- Works with any team stat function
- Combines results into single dataframe
- Optional progress messages
- Automatic error handling

---

### 2. `player_stats_bulk(stat_function, players, ...)`

Fetch career data for multiple players:

```{r example2, eval=FALSE}
# Compare multiple players
player_stats_bulk(
  player_per_game,
  c("LeBron James", "Michael Jordan", "Kobe Bryant")
)

# Playoff comparison
player_stats_bulk(
  player_advanced,
  c("Stephen Curry", "Kevin Durant"),
  season_type = "playoffs"
)
```

Features:
- Works with any player stat function
- Combines results for easy comparison
- Accepts player names or IDs
- Optional progress messages

---

### 3. Enhanced Aggregate Functions

`team_stats_totals()` and `team_stats_per_game()` now accept `years` parameter:

```{r example3, eval=FALSE}
# All seasons (default)
team_stats_totals("LAL")

# Specific range
team_stats_totals("LAL", years = 2015:2024)

# Selected years
team_stats_per_game("BOS", years = c(2008, 2010, 2020))
```

Features:
- Filter historical data to specific seasons
- Accepts ranges or individual years
- Maintains all original functionality when `years = NULL`

---

## Common Use Cases

### 1. Compare Finals Opponents
```{r use_case_1, eval=FALSE}
finals_matchup <- team_stats_bulk(
  team_per_game,
  teams = c("LAL", "MIA"),
  years = 2020
)
```

### 2. Track Team Over Time
```{r use_case_2, eval=FALSE}
warriors_dynasty <- team_stats_bulk(
  team_advanced,
  teams = "GSW",
  years = 2015:2019
)
```

### 3. Compare Player Careers
```{r use_case_3, eval=FALSE}
goats <- player_stats_bulk(
  player_per_game,
  players = c("LeBron James", "Michael Jordan")
)
```

### 4. Analyze Championship Era
```{r use_case_4, eval=FALSE}
lakers_championships <- team_stats_totals(
  "LAL",
  years = c(2000, 2001, 2002, 2009, 2010, 2020)
)
```
